<!DOCTYPE html>
<html>
<head>
    <title>🚨 TESTE REAL OAUTH FLOW - MIX</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: linear-gradient(45deg, #ff6b9d, #a855f7, #3b82f6); min-height: 100vh; }
        .container { max-width: 900px; margin: 0 auto; background: white; padding: 30px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); }
        .btn { padding: 20px 30px; margin: 10px; text-decoration: none; border-radius: 10px; display: inline-block; color: white; font-weight: bold; font-size: 16px; transition: all 0.3s; }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(0,0,0,0.3); }
        .google { background: #4285f4; }
        .facebook { background: #1877f2; }
        .register { background: #28a745; }
        .logs { background: #f8f9fa; padding: 20px; border-radius: 10px; font-family: monospace; margin: 20px 0; border: 1px solid #ddd; }
        .error { color: #dc3545; font-weight: bold; }
        .success { color: #28a745; font-weight: bold; }
        .warning { color: #ffc107; font-weight: bold; }
        .steps { background: #e9ecef; padding: 15px; margin: 15px 0; border-radius: 8px; }
        h1 { color: #333; text-align: center; margin-bottom: 30px; }
        h2 { color: #495057; border-bottom: 2px solid #007bff; padding-bottom: 10px; }
        .highlight { background: #fff3cd; padding: 15px; border-left: 4px solid #ffc107; margin: 15px 0; border-radius: 5px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>🚨 TESTE REAL OAUTH FLOW - MIX</h1>
        
        <div class="highlight">
            <h3>🎯 REPRODUZINDO PROBLEMA EXATO DO USUÁRIO:</h3>
            <p><strong>Problema:</strong> "Acesse cadastrar conta, escolha Google, faça login, aparece página de erro"</p>
            <p><strong>Objetivo:</strong> Identificar onde o fluxo falha e corrigir</p>
        </div>
        
        <h2>🔥 PASSO A PASSO DO TESTE:</h2>
        
        <div class="steps">
            <h3>1. ACESSE A PÁGINA DE CADASTRO:</h3>
            <a href="/register" class="btn register">📝 CADASTRAR CONTA</a>
            <p><small>Vai para a página de cadastro oficial do MIX</small></p>
        </div>
        
        <div class="steps">
            <h3>2. ESCOLHA GOOGLE OAUTH:</h3>
            <p>Na página de cadastro, clique em <strong>"Continuar com Google"</strong></p>
            <p>Isso deve redirecionar para: <code>https://accounts.google.com/o/oauth2/v2/auth</code></p>
        </div>
        
        <div class="steps">
            <h3>3. FAÇA LOGIN NO GOOGLE:</h3>
            <p>Complete o login com sua conta Google</p>
            <p>Autorize o aplicativo MIX quando solicitado</p>
        </div>
        
        <div class="steps">
            <h3>4. OBSERVE O RESULTADO:</h3>
            <p>Deve retornar para: <code>http://localhost:5000/api/auth/google/callback</code></p>
            <p>E então redirecionar para: <code>/oauth-welcome</code></p>
        </div>
        
        <div class="logs">
            <h3>🔍 LOGS ESPERADOS NO SERVIDOR:</h3>
            <pre class="success">
🔵 Google OAuth callback route accessed
🔵 Query params: { code: '4/0AeaYSHA...', state: '', scope: 'email profile openid' }
🔵 GOOGLE OAUTH CALLBACK AUTHENTICATE RESULT:
🔵 Error: null
🔵 User: test@gmail.com (NEW)
🔵 Attempting to log in user: test@gmail.com
🔵 ✅ USER LOGGED IN SUCCESSFULLY: test@gmail.com
🔵 Session after login: { ... }
🔵 req.isAuthenticated(): true
🔵 req.user: { ... }
🔵 ✅ NEW USER DETECTED - redirecting to oauth-welcome
🔵 Redirect URL: /oauth-welcome
            </pre>
        </div>
        
        <div class="logs">
            <h3>🚨 POSSÍVEIS ERROS:</h3>
            <div class="error">
                <p>❌ TokenError: Malformed auth code</p>
                <p>❌ Error: No user returned from OAuth</p>
                <p>❌ Session not maintained after login</p>
                <p>❌ oauth-welcome page fails to load user data</p>
            </div>
        </div>
        
        <h2>🧪 TESTES DIRETOS:</h2>
        
        <div style="margin: 20px 0;">
            <h3>Teste 1: Acesso direto ao Google OAuth</h3>
            <a href="/api/auth/google" class="btn google">🟢 TESTE GOOGLE OAUTH DIRETO</a>
        </div>
        
        <div style="margin: 20px 0;">
            <h3>Teste 2: Acesso direto ao Facebook OAuth</h3>
            <a href="/api/auth/facebook" class="btn facebook">🔵 TESTE FACEBOOK OAUTH DIRETO</a>
        </div>
        
        <div class="highlight">
            <h3>📝 INSTRUÇÕES PARA DEBUGGING:</h3>
            <ol>
                <li><strong>Abra o console do navegador</strong> (F12)</li>
                <li><strong>Monitore os logs do servidor</strong> no terminal</li>
                <li><strong>Siga o fluxo completo</strong> desde o cadastro até o erro</li>
                <li><strong>Documente exatamente</strong> onde o erro ocorre</li>
                <li><strong>Capture screenshot</strong> da página de erro</li>
            </ol>
        </div>
        
        <div style="text-align: center; margin-top: 30px;">
            <p><strong>🚨 AGORA VAMOS REPRODUZIR O ERRO EXATO</strong></p>
            <a href="/login" class="btn" style="background: #6c757d;">← Voltar para Login</a>
        </div>
    </div>
</body>
</html>